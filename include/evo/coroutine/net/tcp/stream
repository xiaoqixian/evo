// -*- C++ -*-
// Date:   Sun May 04 17:45:18 2025
// Mail:   lunar_ubuntu@qq.com
// Author: https://github.com/xiaoqixian

#pragma once

#include "evo/coroutine/fd"
#include "evo/coroutine/task"
#include <netinet/in.h>

namespace evo::coro::net {

class TcpStream {
  Fd fd_;
  
public:
  TcpStream(int raw_fd): fd_(raw_fd) {}
  TcpStream(Fd fd): fd_(std::move(fd)) {
    LOG_TRACE("TcpStream Fd fd = {}", (int)fd);
  }

  TcpStream(TcpStream const&) = delete;
  TcpStream(TcpStream && other) noexcept
    : fd_(std::move(other.fd_))
  {}

  task<int> read(char* buf, size_t size);

  task<int> write(char const* buf, size_t size);

  static task<TcpStream> connect(const char* addr, u16 port);
  static task<TcpStream> connect(::sockaddr_in);
};

} // namespace evo::coro::net
